<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="memberHsy">

	<!-- 모든 직원 정보 가져오기 -->
	<select id="selectAllMember" resultType="com.t1works.groupware.hsy.model.MemberHsyVO">
		select * from tbl_employee order by fk_pcode desc
	</select>
	
	
	<!-- 검색조건이 있는 직원목록 총페이지 -->
	<select id="selectTotalPage1" parameterType="HashMap" resultType="Integer">
		select ceil(count(*)/#{sizePerPage}) as cnt 
		from tbl_employee 
		left join tbl_department on fk_dcode=dcode
		left join tbl_position on fk_pcode=pcode
		where ${searchType} like '%'|| #{searchWord} ||'%'
	</select>
	
	
	<!-- 검색조건이 없는 직원목록 총페이지 -->
	<select id="selectTotalPage2" parameterType="String" resultType="Integer">
		select ceil(count(*)/#{sizePerPage}) as cnt from tbl_employee
	</select>
	
	
	<!-- 검색조건이 있는 직원목록 가져오기 (페이징처리) -->
	<select id="selectPagingMember1"  parameterType="HashMap" resultType="com.t1works.groupware.hsy.model.MemberHsyVO">
		select rno, employeeid, name, pname, dname, mobile, cmobile, email
		from
		(
			select rownum as rno, employeeid, name, pname, dname, mobile, cmobile, email
			from 
			(
				select employeeid, name, pname, nvl(dname,'-') as dname, nvl2(mobile,(substr(mobile,1,3)||'-'||substr(mobile,4,4)||'-'||substr(mobile,8)),'-') as mobile, 
		        substr(cmobile,1,2)||'-'||substr(cmobile,3,4)||'-'||substr(cmobile,7) as cmobile, email
				from tbl_employee left join tbl_department on fk_dcode=dcode
				left join tbl_position on fk_pcode=pcode
				where ${searchType} like '%'||#{searchWord}||'%'
				order by pcode desc
			) V1
		) V2
		where rno between #{start} and #{end}
		order by rno
	</select>
	
	
	<!-- 검색조건이 없는 직원목록 가져오기 (페이징처리) -->
	<select id="selectPagingMember2"  parameterType="HashMap" resultType="com.t1works.groupware.hsy.model.MemberHsyVO">
		select rno, employeeid, name, pname, dname, mobile, cmobile, email
		from
		(
			select rownum as rno, employeeid, name, pname, dname, mobile, cmobile, email
			from 
			(
				select employeeid, name, pname, nvl(dname,'-') as dname, nvl2(mobile,(substr(mobile,1,3)||'-'||substr(mobile,4,4)||'-'||substr(mobile,8)),'-') as mobile, 
		        substr(cmobile,1,2)||'-'||substr(cmobile,3,4)||'-'||substr(cmobile,7) as cmobile, email
				from tbl_employee left join tbl_department on fk_dcode=dcode
				left join tbl_position on fk_pcode=pcode
				order by pcode desc
			) V1
		) V2
		where rno between #{start} and #{end}
		order by rno
	</select>
	
	
	<!-- 사번에 해당하는 직원정보 가져오기  -->
	<select id="employeeInfoAjaxHsy" parameterType="String" resultType="com.t1works.groupware.hsy.model.MemberHsyVO">
		select employeeid, email, name, nvl2(mobile,(substr(mobile,1,3)||'-'||substr(mobile,4,4)||'-'||substr(mobile,8)),'-') as mobile,
	      	   substr(cmobile,1,2)||'-'||substr(cmobile,3,4)||'-'||substr(cmobile,7) as cmobile, nvl(dname,'-') as dname, pname, salary, nvl(duty,'-') as duty
		from tbl_employee left join tbl_department on fk_dcode=dcode
		left join tbl_position on fk_pcode=pcode
		where employeeid= #{employeeid}
	</select>
	
	
</mapper>