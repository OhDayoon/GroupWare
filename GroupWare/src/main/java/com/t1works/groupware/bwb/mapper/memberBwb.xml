<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="memberBwb">
   
   <select id="selectMember" parameterType="HashMap" resultType="com.t1works.groupware.bwb.model.MemberBwbVO">
      select *
      from tbl_employee
      where employeeid = #{employeeid} and passwd = #{passwd}
   </select>
	
   <insert id="insertlogin_history">
	  insert into login_history(loginno,fk_employeeid,loginip)
	  values(seq_login_history_loginno.nextval,#{employeeid},#{loginip})
   </insert>
   
   <!-- 출퇴근기록 테이블에 insert하기(출근시간) -->
   <insert id="insertIntime" parameterType="HashMap"> 
	  insert into tbl_inout(gooutdate,fk_employeeid,intime,lateno)
	  values(to_date(#{gooutdate}),#{fk_employeeid},sysdate,0)			
   </insert>
   
   <!-- 출퇴근기록 테이블에 select하기(출근시간) -->
   <select id="selectIntime" resultType="String" parameterType="HashMap">
   	  select to_char(intime,'hh24:mi:ss') from tbl_inout
   	  where gooutdate=#{gooutdate} and fk_employeeid=#{fk_employeeid}
   </select>
   
   <!-- 출근시간 지각여부 확인하기  -->
   <select id="selectlateno" parameterType="String" resultType="String">
   	  select sign(to_date(#{intime},'hh24:mi:ss')- to_date('09:30:00','hh24:mi:ss')) as late
	  from dual
   </select>
   
   <!-- 출근시간 지각여부 확인 후 지각 시  update하기  -->
   <update id="updateLateno" parameterType="HashMap">
	  update tbl_inout set lateno = '1'
	  where gooutdate=#{gooutdate} and fk_employeeid=#{fk_employeeid} 
   </update>
   
   <!-- 출퇴근기록 테이블에 update하기(퇴근시간) -->
   <update id="updateOuttime" parameterType="HashMap">
	  update tbl_inout set outtime = sysdate
	  where gooutdate=#{gooutdate} and fk_employeeid=#{fk_employeeid} 
   </update>
   
   <!-- 출퇴근기록 테이블에 select하기(퇴근시간) -->
   <select id="selectOuttime" resultType="String" parameterType="HashMap">
   	  select to_char(outtime,'hh24:mi:ss') from tbl_inout
   	  where gooutdate=#{gooutdate} and fk_employeeid=#{fk_employeeid}
   </select>
   
   <!-- 모든 직위가져오기 -->
   <select id="selectPositionList" resultType="com.t1works.groupware.bwb.model.MemberBwbVO">
   		select pname from tbl_position
   </select>
   
   <!-- 소속에 따른 직무 가져오기 -->
   <select id="selectDuty" parameterType="String" resultType="String">
   		select duty from tbl_department
   		where dname = #{dname}
   </select>
   
   
    <resultMap type="HashMap" id="PDMap"> 
		<result property="fk_pcode" column="pcode" javaType="String" /> 
		<result property="fk_dcode" column="dcode" javaType="String" />
	</resultMap>
   
   <!-- name과 dname을 통해 pcode,dcode 가져오기. -->  
   <select id="selectPDcode" parameterType="HashMap" resultMap="PDMap">
	   	select pcode, dcode
		from tbl_department
		cross join tbl_position
		where dname = #{dname} and pname= #{pname}
   </select>
   
   <!-- 회원정보 update하기 -->
   <update id="updateOneInfo" parameterType="com.t1works.groupware.bwb.model.MemberBwbVO">
   		update tbl_employee set fk_dcode = #{fk_dcode}, fk_pcode = #{fk_pcode}, name=#{name}, email=#{email}, mobile=#{mobile}, cmobile=#{cmobile}
   		where employeeid = #{employeeid}
   </update>
   
   
   
</mapper>